/*
 * Copyright (C) 2018 Amotus Solutions, Inc.
 */

/dts-v1/;

#include "imx6ull-dart6ul.dtsi"
#include "imx6ull-dart6ul-emmc-wifi.dtsi"
#include "imx6ull-dart6ul-ethernet.dtsi"

/ {
	model = "IDE Systems DistributionBox";
	compatible = "ide,imx6ull-dart6ul-ide", "fsl,imx6ull";

	chosen {
		stdout-path = &uart1;
	};

	leds {
		pinctrl-names = "default";
		pinctrl-0 = <&pinctrl_led1 &pinctrl_led2>;

		compatible = "gpio-leds";

		led1 {
			label = "external:green:heartbeat";
			gpios = <&gpio5 5 GPIO_ACTIVE_HIGH>;
			linux,default-trigger = "heartbeat";
			default-state = "off";
		};

		led2 {
			label = "external:red:fault";
			gpios = <&gpio5 3 GPIO_ACTIVE_HIGH>;
			default-state = "off";
		};

		led3 {
			label = "internal:green:heartbeat";
			gpios = <&gpio5 1 GPIO_ACTIVE_HIGH>;
			linux,default-trigger = "hearbeat";
			default-state = "off";
		};

		led4 {
			label = "internal:red:fault";
			gpios = <&gpio4 24 GPIO_ACTIVE_HIGH>;
			default-state = "off";
		};
	};

	pps {
		pinctrl-names = "default";
		pinctrl-0 = <&pinctrl_pps>;
		compatible = "pps-gpio";
		gpios = <&gpio1 9 GPIO_ACTIVE_HIGH>;
		status = "okay";
	};

	/* control board id: 0, 1 or 2. 3 means missing board. */
	gpio-decoder-cbid {
		compatible = "gpio-decoder";
		gpios = <&gpio2 11 GPIO_ACTIVE_HIGH>, <&gpio2 10 GPIO_ACTIVE_HIGH>;
		decoder-max-value = <3>;
	};

	/* meter board id: 0, 1 or 2. 3 means missing board. */
	gpio-decoder-meterid {
		compatible = "gpio-decoder";
		gpios = <&gpio1 13 GPIO_ACTIVE_HIGH>, <&gpio2 12 GPIO_ACTIVE_HIGH>;
		decoder-max-value = <3>;
	};

	/* modbus address of the meter board */
	gpio-decoder-modbus-addr {
		compatible = "gpio-decoder";
		gpios = <&gpio1 15 GPIO_ACTIVE_HIGH>, <&gpio1 14 GPIO_ACTIVE_HIGH>;
		decoder-max-value = <3>;
	};
};

&i2c2 {
	rtc: mcp7940x@6f {
		compatible = "microchip,mcp7940x";
		reg = <0x6f>;
	};

	sensor1: lm75@48 {
		compatible = "lm75";
		reg = <0x48>;
		interrupt-parent = <&gpio4>;
		interrupts = <20 IRQ_TYPE_LEVEL_LOW>;
		#thermal-sensor-cells = <0>;
	};
};

/* debug uart */
&uart1 {
	pinctrl-names = "default";
	pinctrl-0 = <&pinctrl_uart1>;
	uart-has-rtscts;
	status = "okay";
};

/* ttymxc2 uart - xbee */
&uart3 {
	pinctrl-names = "default";
	pinctrl-0 = <&pinctrl_uart3 &pinctrl_xbee>;
	uart-has-rtscts;
	status = "okay";
};

/* ttymxc3 uart - rs485-1 */
&uart4 {
	pinctrl-names = "default";
	pinctrl-0 = <&pinctrl_uart4>;
	linux,rs485-enabled-at-boot-time;
	status = "okay";
};

/* ttymxc4 uart - rs485-2 */
&uart5 {
	pinctrl-names = "default";
	pinctrl-0 = <&pinctrl_uart5>;
	linux,rs485-enabled-at-boot-time;
	status = "okay";
};

/* ttymxc5 uart - gps */
&uart6 {
	pinctrl-names = "default";
	pinctrl-0 = <&pinctrl_uart6>;
	status = "okay";
};

&usbotg1 {
	pinctrl-names = "default";
	pinctrl-0 = <&pinctrl_usbotg1>;
	dr_mode = "otg";
	status = "okay";
};

&usbotg2 {
	dr_mode = "host";
	disable-over-current;
	status = "okay";
};

&gpio1 {
	gps_pwr_en {
		gpio-hog;
		gpios = <10 GPIO_ACTIVE_LOW>;
		output-low;
		line-name = "GPS_PWR_EN";
	};

	meter_rst {
		gpio-hog;
		gpios = <11 GPIO_ACTIVE_LOW>;
		output-low;
		line-name = "METER_RST";
	};
};

&gpio2 {
	cb_int0 {
		gpio-hog;
		gpios = <14 GPIO_ACTIVE_HIGH>;
		input;
		line-name = "CB_INT0";
	};

	cb_int1 {
		gpio-hog;
		gpios = <8 GPIO_ACTIVE_HIGH>;
		input;
		line-name = "CB_INT1";
	};

	cb_int2 {
		gpio-hog;
		gpios = <9 GPIO_ACTIVE_HIGH>;
		input;
		line-name = "CB_INT2";
	};

	cb_rst {
		gpio-hog;
		gpios = <13 GPIO_ACTIVE_HIGH>;
		output-low;
		line-name = "CB_RST";
	};

	cb_gpioa {
		gpio-hog;
		gpios = <12 GPIO_ACTIVE_HIGH>;
		input;
		line-name = "CB_GPIOA";
	};

	cb_gpiob {
		gpio-hog;
		gpios = <15 GPIO_ACTIVE_HIGH>;
		input;
		line-name = "CB_GPIOB";
	};
};

&gpio4 {
	meter_pc7 {
		gpio-hog;
		gpios = <25 GPIO_ACTIVE_HIGH>;
		input;
		line-name = "METER_PC7";
	};

	meter_pc8 {
		gpio-hog;
		gpios = <26 GPIO_ACTIVE_HIGH>;
		input;
		line-name = "METER_PC8";
	};

	meter_pc9 {
		gpio-hog;
		gpios = <28 GPIO_ACTIVE_HIGH>;
		input;
		line-name = "METER_PC9";
	};

	meter_pc10 {
		gpio-hog;
		gpios = <27 GPIO_ACTIVE_HIGH>;
		input;
		line-name = "METER_PC10";
	};
};

&gpio5 {
	xbee_rst {
		gpio-hog;
		gpios = <8 GPIO_ACTIVE_LOW>;
		output-low;
		line-name = "XBEE_RST";
	};

	xbee_sleep {
		gpio-hog;
		gpios = <9 GPIO_ACTIVE_LOW>;
		output-low;
		line-name = "XBEE_SLEEP";
	};
};

&iomuxc {
	pinctrl-names = "default";
	pinctrl-0 = <&pinctrl_hog1 &pinctrl_gpspwr>;

	pinctrl_hog1: hog1grp {
		fsl,pins = <
		/* Control board gpios */
		MX6UL_PAD_ENET2_RX_DATA0__GPIO2_IO08   0x1b0b0 /* CB_INT1 */
		MX6UL_PAD_ENET2_RX_DATA1__GPIO2_IO09   0x1b0b0 /* CB_INT2 */
		MX6UL_PAD_ENET2_RX_EN__GPIO2_IO10      0x1b0b0 /* CB_ID0 */
		MX6UL_PAD_ENET2_TX_DATA0__GPIO2_IO11   0x1b0b0 /* CB_ID1 */
		MX6UL_PAD_ENET2_TX_DATA1__GPIO2_IO12   0x1b0b0 /* CB_GPIOA */
		MX6UL_PAD_ENET2_TX_EN__GPIO2_IO13      0x1b0b0 /* CB_RST */
		MX6UL_PAD_ENET2_TX_CLK__GPIO2_IO14     0x1b0b0 /* CB_INT0 */
		MX6UL_PAD_ENET2_RX_ER__GPIO2_IO15      0x1b0b0 /* CB_GPIOB */
		/* Meter gpios */
		MX6UL_PAD_JTAG_TMS__GPIO1_IO11	       0x1b0b0 /* METER_RSTn */
		MX6UL_PAD_JTAG_TDO__GPIO1_IO12	       0x1b0b0 /* METER_ID_B0 */
		MX6UL_PAD_JTAG_TDI__GPIO1_IO13	       0x1b0b0 /* METER_ID_B1 */
		MX6UL_PAD_JTAG_TCK__GPIO1_IO14	       0x1b0b0 /* METER_ADR_B0 */
		MX6UL_PAD_JTAG_TRST_B__GPIO1_IO15      0x1b0b0 /* METER_ADR_B1 */
		MX6UL_PAD_CSI_DATA04__GPIO4_IO25       0x1b0b0 /* METER_PC7 */
		MX6UL_PAD_CSI_DATA05__GPIO4_IO26       0x1b0b0 /* METER_PC8 */
		MX6UL_PAD_CSI_DATA06__GPIO4_IO27       0x1b0b0 /* METER_PC10 */
		MX6UL_PAD_CSI_DATA07__GPIO4_IO28       0x1b0b0 /* METER_PC9 */
		>;
	};

	pinctrl_uart1: uart1grp {
		fsl,pins = <
		MX6UL_PAD_UART1_TX_DATA__UART1_DCE_TX	0x1b0b1
		MX6UL_PAD_UART1_RX_DATA__UART1_DCE_RX	0x1b0b1
		MX6UL_PAD_UART1_CTS_B__UART1_DCE_CTS	0x1b0b1
		MX6UL_PAD_UART1_RTS_B__UART1_DCE_RTS	0x1b0b1
		>;
	};

	pinctrl_gpspwr: gpspwrgrp {
		fsl,pins = <
		MX6UL_PAD_JTAG_MOD__GPIO1_IO10	       0x1b0b0 /* GPS power-enable */
		>;
	};

	pinctrl_sensor: sensorgrp {
		fsl,pins = <
		MX6UL_PAD_CSI_HSYNC__GPIO4_IO20	       0x1b0b0 /* Over temperature irq */
		>;
	};

	pinctrl_pps: ppsgrp {
		fsl,pins = <
		MX6UL_PAD_GPIO1_IO09__GPIO1_IO09       0x1b0b0 /* GPS PPS (default: 1Hz) */
		>;
	};

	pinctrl_led1: ledgrp {
		fsl,pins = <
		MX6UL_PAD_CSI_DATA03__GPIO4_IO24       0x1b0b0 /* Internal red led */
		>;
	};

	pinctrl_usbotg1: usbotg1grp {
		fsl,pins = <
		MX6UL_PAD_GPIO1_IO01__USB_OTG1_OC      0x1b0b0
		MX6UL_PAD_GPIO1_IO04__USB_OTG1_PWR     0x80000000
		>;
	};

	pinctrl_uart3: uart3grp {
		fsl,pins = <
		MX6UL_PAD_UART3_TX_DATA__UART3_DCE_TX	0x1b0b1
		MX6UL_PAD_UART3_RX_DATA__UART3_DCE_RX	0x1b0b1
		MX6UL_PAD_UART3_CTS_B__UART3_DCE_CTS	0x1b0b1
		MX6UL_PAD_UART3_RTS_B__UART3_DCE_RTS	0x1b0b1
		>;
	};

	pinctrl_uart4: uart4grp {
		fsl,pins = <
		MX6UL_PAD_LCD_CLK__UART4_DCE_TX		0x1b0b1
		MX6UL_PAD_LCD_ENABLE__UART4_DCE_RX	0x1b0b1
		MX6UL_PAD_LCD_VSYNC__UART4_DCE_RTS	0x1b0b1
		>;
	};

	pinctrl_uart5: uart5grp {
		fsl,pins = <
		MX6UL_PAD_CSI_DATA00__UART5_DCE_TX	0x1b0b1
		MX6UL_PAD_CSI_DATA01__UART5_DCE_RX	0x1b0b1
		MX6UL_PAD_CSI_DATA02__UART5_DCE_RTS	0x1b0b1
		>;
	};

	pinctrl_uart6: uart6grp {
		fsl,pins = <
		MX6UL_PAD_CSI_MCLK__UART6_DCE_TX	0x1b0b1
		MX6UL_PAD_CSI_PIXCLK__UART6_DCE_RX	0x1b0b1
		>;
	};
};

&iomuxc_snvs {
	pinctrl_led2: ledgrp {
		fsl,pins = <
		MX6ULL_PAD_SNVS_TAMPER5__GPIO5_IO05	0x1b0b0 /* External green led */
		MX6ULL_PAD_SNVS_TAMPER3__GPIO5_IO03	0x1b0b0 /* External red led */
		MX6ULL_PAD_SNVS_TAMPER1__GPIO5_IO01	0x1b0b0 /* Internal green led */
		>;
	};

	pinctrl_xbee: xbeegrp {
		fsl,pins = <
		MX6ULL_PAD_SNVS_TAMPER8__GPIO5_IO08	0x1b0b0 /* XBee reset */
		MX6ULL_PAD_SNVS_TAMPER9__GPIO5_IO09	0x1b0b0 /* XBee sleep */
		>;
	};

	pinctrl_alarm: alarmgrp {
		fsl,pins = <
		MX6ULL_PAD_SNVS_TAMPER7__GPIO5_IO07	0x1b0b0 /* RTC alarm */
		>;
	};
};
